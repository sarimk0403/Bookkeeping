<!doctype html>
<html>
<head>
  <link rel="manifest" href="/static/manifest.json">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <link rel="apple-touch-icon" href="/static/icons/icon-192.png">

  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>{{ title }}</title>

  <!-- Your app-wide CSS from app.py -->
  <style>{{ css }}</style>

  <!-- Mobile-first layout fixes -->
  <style>
    /* Respect iOS safe-area (Dynamic Island / notch) */
    body { padding-top: max(0px, env(safe-area-inset-top)); }

    /* --- NAV: space, equal sizing, and clean wrapping on phones --- */
    .navbar{
      display:flex; align-items:center; justify-content:space-between;
      gap:.75rem; flex-wrap:wrap; margin-bottom:18px;
    }
    .nav-brand{ font-weight:800; font-size:20px; letter-spacing:.3px; white-space:nowrap; }
    .nav-actions{ display:flex; flex-wrap:wrap; gap:.5rem .5rem; }

    /* Make all top buttons the same height & nicely padded */
    .nav-actions .btn{
      display:inline-flex; align-items:center; justify-content:center;
      height:44px; padding:0 14px; font-size:15px; font-weight:600; border-radius:12px;
    }

    /* Phone layout: turn buttons into a tidy grid with breathing room */
    @media (max-width: 780px){
      .navbar{ position:sticky; top:0; z-index:20; background:var(--bg); padding-top:6px; padding-bottom:6px; }
      .nav-actions{
        display:grid; grid-template-columns: repeat(2, minmax(0,1fr));
        gap:.6rem; width:100%;
      }
      .nav-actions .btn{ width:100%; min-width:0; height:46px; }
      .nav-brand{ font-size:18px; }
    }
    @media (max-width: 420px){
      .nav-actions{ grid-template-columns: 1fr; } /* one per row on very small phones */
    }

    /* --- KPIs: add a touch more spacing on phones --- */
    @media (max-width: 780px){
      .kpis{ gap:10px; }
      .kpi .value{ font-size:22px; }
    }

    /* --- Top 5 Categories: convert the inline 5-column grid to a responsive masonry-like grid --- */
    /* The container immediately after the "Top 5 Categories" title is that grid. */
    .section-title + div{
      display:grid !important;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)) !important;
      gap:10px !important;
    }
    .section-title + div .card{
      padding:12px !important;
      display:flex; flex-direction:column; gap:4px;
      align-items:flex-start; justify-content:center;
      min-height:64px;
    }
    .section-title + div .card div:first-child{ font-size:12px; opacity:.85; }
    .section-title + div .card div:last-child{ font-weight:800; font-size:16px; }

    /* --- Tables: keep horizontal scroll smooth when needed --- */
    .table-wrap{ overflow-x:auto; -webkit-overflow-scrolling:touch; }

    /* Optional: tighter inputs on phones for nicer form fit */
    @media (max-width: 780px){
      input, select, textarea{ padding:10px 12px; }
      .btn{ padding:10px 12px; }
    }
  </style>
</head>
<body>
  <div class="container">

    <nav class="navbar">
      <div class="nav-brand">{{ title }}</div>
      <div class="nav-actions">
        {% if session.get('authed') %}
          <a href="{{ url_for('index') }}" class="btn">Dashboard</a>
          <a href="{{ url_for('expenses') }}" class="btn">Expenses</a>
          <a href="{{ url_for('add') }}" class="btn primary">+ Add Expense</a>
          <a href="{{ url_for('logout') }}" class="btn">Logout</a>
        {% endif %}
      </div>
    </nav>

    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        {% for cat, msg in messages %}
          <div class="flash {{cat}}">{{ msg }}</div>
        {% endfor %}
      {% endif %}
    {% endwith %}

    <div class="card">
      {% block content %}{% endblock %}
    </div>

    <div class="footer">
      Lightweight internal app. Max upload 25MB. Allowed: png, jpg, jpeg, pdf.
    </div>
  </div>
</body>
</html>
